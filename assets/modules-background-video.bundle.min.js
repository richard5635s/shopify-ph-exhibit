const e=function(){const e="link",t="script",i="requested",s="loaded",o="https://cdn.shopify.com/shopifycloud/",n={youtubeSdk:{tagId:"youtube-sdk",src:"https://www.youtube.com/iframe_api",type:t},vimeoSdk:{tagId:"vimeo-sdk",src:"https://player.vimeo.com/api/player.js",type:t},plyrShopifyStyles:{tagId:"plyr-shopify-styles",src:o+"plyr/v2.0/shopify-plyr.css",type:e},shopifyXr:{tagId:"shopify-model-viewer-xr",src:o+"shopify-xr-js/assets/v1.0/shopify-xr.en.js",type:t},modelViewerUi:{tagId:"shopify-model-viewer-ui",src:o+"model-viewer-ui/assets/v1.0/model-viewer-ui.en.js",type:t},modelViewerUiStyles:{tagId:"shopify-model-viewer-ui-styles",src:o+"model-viewer-ui/assets/v1.0/model-viewer-ui.css",type:e}};return{load:function(o,r){const a=n[o];if(!a)return;if(a.status===i)return;if(r=r||function(){},a.status===s)return void r();let d;switch(a.status=i,a.type){case t:d=function(e,t){const i=document.createElement("script");return i.src=e.src,i.addEventListener("load",(function(){e.status=s,t()})),i}(a,r);break;case e:d=function(e,t){const i=document.createElement("link");return i.href=e.src,i.rel="stylesheet",i.type="text/css",i.addEventListener("load",(function(){e.status=s,t()})),i}(a,r)}d.id=a.tagId,a.element=d;const l=document.getElementsByTagName(a.type)[0];l.parentNode.insertBefore(d,l)}}}(),t=function(){function e(){let e;e="undefined"!=typeof THEMENAME?THEMENAME:void 0!==theme.info.name?theme.info.name:"theme";const t=e.toLowerCase();this.options={rootMargin:"25% 0px 75% 0px"},this.callback=function(e,i){e.forEach((function(e){e.isIntersecting?e.target.dispatchEvent(new CustomEvent(`${t}:video-component:visible`,{bubbles:!1,cancelable:!1})):e.target.dispatchEvent(new CustomEvent(`${t}:video-component:not-visible`,{bubbles:!1,cancelable:!1}))}))},this._observedElementsCount=0}return e.prototype=Object.assign({},e.prototype,{_init:function(){"IntersectionObserver"in window&&(this._observer=new IntersectionObserver(this.callback,this.options))},_isInitialized:function(){return this._observedElementsCount>0},observe:function(e){try{this._isInitialized()||this._init(),this._observer.observe(e),this._observedElementsCount++}catch(e){console.error(e)}},unobserve:function(e){this._observer&&(this._observer.unobserve(e),this._observedElementsCount--,0===this._observedElementsCount&&this._deInit())},_deInit:function(){this._observer.disconnect()}}),e}(),i=[];document.addEventListener("alpine:init",(()=>{Alpine.data("ThemeModule_BackgroundVideo",(({videoType:s,videoId:o})=>({init(){s&&o?(this.componentId=this.$root.id,this.videoProvider=s,this.videoId=o,this.playerId=`player-${this.componentId}`,this.YTReady=!1,this.selectors={fallBackImage:"[data-fallback-image]",player:`#${this.playerId}`},this.classes={isPlaying:"is-playing",hidden:"hidden",errorElClass:"background-video__error",tallIframeClass:"background-video-iframe--tall"},this.eventHandlers={},Shopify.designMode&&document.addEventListener("shopify:section:unload",(e=>{e.target.contains(this.$root)&&this.deinit()})),this._init()):this._showFallBackImage()},_onPlayerStateChange(e){const t=i[this.playerId];1===e&&(this._hideFallBackImage(),this.$root.classList.add(this.classes.isPlaying)),-1===e&&(this.$root.classList.remove(this.classes.isPlaying),!0===t.didBuffer&&this._showFallBackImage()),3===e&&(t.didBuffer=!0)},_init(){"youtube"===this.videoProvider?"undefined"!=typeof YT?this._initYTVideo():(document.body.addEventListener("youtubeiframeapiready",(()=>{this._initYTVideo()})),e.load("youtubeSdk")):(this.htmlVideoEl=this.$root.querySelector("video"),this.htmlVideoEl.id=this.playerId,this._initVideoContainerObserver()),this.fallBackImageEl=this.$root.querySelector(this.selectors.fallBackImage),this.playerEl=this.$root.querySelector(this.selectors.player),this.eventHandlers.inView=this._inView.bind(this),this.eventHandlers.outOfView=this._outOfView.bind(this),this.$root.addEventListener("switch:video-component:visible",this.eventHandlers.inView),this.$root.addEventListener("switch:video-component:not-visible",this.eventHandlers.outOfView)},_showFallBackImage(){this.fallBackImageEl&&(this.fallBackImageEl.classList.remove(this.classes.hidden),this.playerEl&&this.playerEl.classList.add(this.classes.hidden))},_hideFallBackImage(){this.fallBackImageEl&&(this.fallBackImageEl.classList.add(this.classes.hidden),this.playerEl&&this.playerEl.classList.remove(this.classes.hidden))},_showErrorMessage(e){const t=this.$root.querySelector(`.${this.classes.errorElClass}`);null!==t&&t.remove();const i=document.createElement("div");i.classList.add(this.classes.errorElClass),i.innerText=e,this.$root.prepend(i)},_onYTPlayerError(e){let t="";switch(e.data){case 2:t="Cascade Background Video: Invalid parameter value";break;case 100:t="Cascade Background Video: Video not found";break;case 101:case 150:t="Cascade Background Video: Video owner does not permit embedding";break;default:t="Cascade Background Video: An error occurred"}""!==t&&(console.error(t),Shopify.designMode&&this._showErrorMessage(t)),Shopify.designMode||this._showFallBackImage()},_onYTPlayerReady(){!0===this.YTReady?this._play():(this.YTReady=!0,this._initResponsiveVideoContainer(),this._initVideoContainerObserver())},_initYTVideo(){i[this.playerId]=new YT.Player(this.playerId,{videoId:this.videoId,width:1280,height:720,events:{onError:function(e){this._onYTPlayerError(e)}.bind(this),onReady:function(e){this._onYTPlayerReady(e)}.bind(this),onStateChange:function(e){0===e.data&&e.target.seekTo(0),this._onPlayerStateChange(e.data)}.bind(this)},playerVars:{autohide:0,branding:0,cc_load_policy:0,controls:0,fs:0,iv_load_policy:3,modestbranding:1,playsinline:1,quality:"hd720",rel:0,showinfo:0,wmode:"opaque"}}),document.getElementById(this.playerId).setAttribute("tabindex","-1")},_inView(){this._play()},_outOfView(){this._pause()},_play(){if("youtube"===this.videoProvider){if(!0===this.YTReady){const e=i[this.playerId];e.mute(),e.playVideo()}}else this.htmlVideoEl.play()},_pause(){"youtube"===this.videoProvider?!0===this.YTReady&&i[this.playerId].pauseVideo():this.htmlVideoEl.pause()},_checkContainerSize(){const e=document.getElementById(this.playerId),t=(16/9).toFixed(2),i=(this.$root.clientWidth/this.$root.clientHeight).toFixed(2);if(e.classList.remove(this.classes.tallIframeClass),e.style.width="",e.style.left="",i<t){e.classList.add(this.classes.tallIframeClass);const s=(t/i*100).toFixed(2),o=(s-100)/2;e.style.width=`${s}%`,e.style.left=`-${o}%`}},_initResponsiveVideoContainer(){this._checkContainerSize(),this._debouncedCheckContainerSize=debounce(this._checkContainerSize.bind(this),300),window.addEventListener("resize",this._debouncedCheckContainerSize)},_initVideoContainerObserver(){void 0===window._videoComponentObserver&&(window._videoComponentObserver=new t),window._videoComponentObserver.observe(this.$root)},deinit(){window._videoComponentObserver.unobserve(this.$root),window.removeEventListener("resize",this._debouncedCheckContainerSize),this.$root.removeEventListener("label:video-component:visible",this.eventHandlers.inView),this.$root.removeEventListener("label:video-component:not-visible",this.eventHandlers.outOfView),window.removeEventListener("resize",this._debouncedCheckContainerSize),i[this.playerId].destroy()}})))}));
