{%- liquid
  assign sidebar_drawer_id = 'sidebar-product-measurement'
-%}
<button
  type="button"
  class="text-left hover:underline"
  @click="$store.modals.open('{{ sidebar_drawer_id }}');"
>
  Tap to show drawer
</button>

<div
  x-data
  x-init="
      initTeleport($root);
    $store.modals.register('{{ sidebar_drawer_id }}', 'leftDrawer');
  "
>
  <template data-should-teleport="#left-drawer-slot">
    <div
      x-show="$store.modals.leftDrawer.contents === '{{ sidebar_drawer_id }}'"
      class="sidebar-nav text-scheme-text menu-drawer text-menu-drawer max-h-full flex flex-col h-screen text-scale-n0 lg:text-scale-n0"
    >
      <div class="p-2 lg:p-4 w-full shrink-0 overflow-hidden">
        <button @click.prevent="$store.modals.close('{{ sidebar_drawer_id }}')" class="block ml-auto top-0">
          <span class="sr-only">{{ 'general.accessibility.close_modal' | t }}</span>
          <span class="inline-block w-4 h-4">{% render 'icon-close' %}</span>
        </button>
      </div>

      <div class="flex-auto flex flex-col overflow-hidden overflow-y-auto overflow-x-auto p-2 lg:p-4 pb-8">
        <div class="space-y-spacer">
          <h3>{{- block.settings.heading -}}</h3>
          {% comment %} {{ block.settings.tablecontent }} {% endcomment %}
          <div id="csv-string-table-container"></div>
          {% comment %} Make code that reads csv and converts it into table {% endcomment %}
        </div>
      </div>
    </div>
  </template>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {

    // Check if PapaParse is loaded
    if (typeof Papa === 'undefined') {
      console.error('PapaParse is not loaded');
      return;
    }

    var csvString = {{ block.settings.tablecontent | json }};
    console.log('CSV String from metafield:', csvString);

    Papa.parse( csvString, {
      header: true,
      complete: function(results) {
        console.log('CSV parsed successfully', results);

        var data = results.data;
        var container = document.getElementById('csv-string-table-container');
        if (data.length) {
          var table = '<table>';

          // Generate table rows
          table += '<tbody>';
          data.forEach(function(row) {
            table += '<tr>';
            row.forEach(function(cell) {
              table += '<td>' + cell + '</td>';
            });
            table += '</tr>';
          });
          table += '</tbody>';
          table += '</table>';

          container.innerHTML = table;
        } else {
          container.innerHTML = '<p>No data found in CSV.</p>';
        }
      }
    });
  });
</script>
